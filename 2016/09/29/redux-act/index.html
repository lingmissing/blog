<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>
    Action构建工具（redux-act） | 时光的涂鸦墙 | code is poetry
  </title>

  
  <meta name="author" content="elaine">
  

  
  <meta name="description" content="JavaScript Developer">
  

  
  
  <meta name="keywords" content="react ,redux">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  
  <meta property="og:title" content="Action构建工具（redux-act）" />
  

  <meta property="og:site_name" content="时光的涂鸦墙" />

  
  <meta property="og:image" content="/blog/favicon.ico" />
  

  <link href="/blog/logo.jpg" rel="icon">
  <link rel="alternate" href="/blog/atom.xml"
    title="时光的涂鸦墙" type="application/atom+xml">
  <link rel="stylesheet" href="/blog/css/style.css" media="screen" type="text/css">
</head>

<body>
  <div class="blog">
    <div class="content">

      <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/blog/">时光的涂鸦墙</a>
    </h1>
    <p class="site-description">code is poetry</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/blog/">主页</a></li>
      
        <li><a href="/blog/archives">归档</a></li>
      
        <li><a href="/blog/tags">标签</a></li>
      
        <li><a href="/blog/about">关于</a></li>
      
    </ul>
  </nav>
</header>

      <main class="site-main posts-loop">
        <article>

  
  
  <h3 class="article-title"><span>
      Action构建工具（redux-act）</span></h3>
  
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2016/09/29/redux-act/" rel="bookmark">
        <time class="entry-date published" datetime="2016-09-29T02:58:40.000Z">
          2016-09-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
      <p>github 路径：<a href="https://github.com/pauldijou/redux-act" target="_blank" rel="noopener">https://github.com/pauldijou/redux-act</a></p>
<p>这是一个自用的工具用于创建<code>actions</code>和<code>reducers</code>用于<code>redux</code>。主要的目标是使用<code>action</code>本身作为<code>reducer</code>的引用而不是变量。</p>
<a id="more"></a>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code>npm install redux-act --save
</code></pre><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>这里有一个名叫<code>createAction</code>的函数，它用于创建一个<code>action</code>，和名叫<code>createActionCreator</code>的方法有点接近。如果你不能确定是否是<code>action</code>或<code>action</code>创造者，那么记住当<code>action</code>创造者是方法时，<code>action</code>是对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Import functions</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAction, createReducer &#125; <span class="keyword">from</span> <span class="string">'redux-act'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an action creator (description is optional)</span></span><br><span class="line"><span class="keyword">const</span> add = createAction(<span class="string">'add some stuff'</span>)</span><br><span class="line"><span class="keyword">const</span> increment = createAction(<span class="string">'increment the state'</span>)</span><br><span class="line"><span class="keyword">const</span> decrement = createAction(<span class="string">'decrement the state'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a reducer</span></span><br><span class="line"><span class="comment">// (ES6 syntax, see Advanced usage below for an alternative for ES5)</span></span><br><span class="line"><span class="keyword">const</span> counterReducer = createReducer(</span><br><span class="line">  &#123;</span><br><span class="line">    [increment]: <span class="function"><span class="params">state</span> =&gt;</span> state + <span class="number">1</span>,</span><br><span class="line">    [decrement]: <span class="function"><span class="params">state</span> =&gt;</span> state - <span class="number">1</span>,</span><br><span class="line">    [add]: <span class="function">(<span class="params">state, payload</span>) =&gt;</span> state + payload</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">) <span class="comment">// &lt;-- This is the default state</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the store</span></span><br><span class="line"><span class="keyword">const</span> counterStore = createStore(counterReducer)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dispatch actions</span></span><br><span class="line">counterStore.dispatch(increment()) <span class="comment">// counterStore.getState() === 1</span></span><br><span class="line">counterStore.dispatch(increment()) <span class="comment">// counterStore.getState() === 2</span></span><br><span class="line">counterStore.dispatch(decrement()) <span class="comment">// counterStore.getState() === 1</span></span><br><span class="line">counterStore.dispatch(add(<span class="number">5</span>)) <span class="comment">// counterStore.getState() === 6</span></span><br></pre></td></tr></table></figure>
<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAction, createReducer &#125; <span class="keyword">from</span> <span class="string">'redux-act'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You can create several action creators at once</span></span><br><span class="line"><span class="comment">// (but that's probably not the best way to do it)</span></span><br><span class="line"><span class="keyword">const</span> [increment, decrement] = [<span class="string">'inc'</span>, <span class="string">'dec'</span>].map(createAction)</span><br><span class="line"></span><br><span class="line"><span class="comment">// When creating action creators, the description is optional</span></span><br><span class="line"><span class="comment">// it will only be used for devtools and logging stuff.</span></span><br><span class="line"><span class="comment">// It's better to put something but feel free to leave it empty if you want to.</span></span><br><span class="line"><span class="keyword">const</span> replace = createAction()</span><br><span class="line"></span><br><span class="line"><span class="comment">// By default, the payload of the action is the first argument</span></span><br><span class="line"><span class="comment">// when you call the action. If you need to support several arguments,</span></span><br><span class="line"><span class="comment">// you can specify a function on how to merge all arguments into</span></span><br><span class="line"><span class="comment">// an unique payload.</span></span><br><span class="line"><span class="keyword">let</span> append = createAction(<span class="string">'optional description'</span>, (...args) =&gt; args.join(<span class="string">''</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// There is another pattern to create reducers</span></span><br><span class="line"><span class="comment">// and it works fine with ES5! (maybe even ES3 \o/)</span></span><br><span class="line"><span class="keyword">const</span> stringReducer = createReducer(<span class="function"><span class="keyword">function</span>(<span class="params">on</span>) </span>&#123;</span><br><span class="line">  on(replace, (state, payload) =&gt; payload)</span><br><span class="line">  on(append, (state, payload) =&gt; (state += payload))</span><br><span class="line">  <span class="comment">// Warning! If you use the same action twice,</span></span><br><span class="line">  <span class="comment">// the second one will override the previous one.</span></span><br><span class="line">&#125;, <span class="string">'missing a lette'</span>) <span class="comment">// &lt;-- Default state</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Rather than binding the action creators each time you want to use them,</span></span><br><span class="line"><span class="comment">// you can do it once and for all as soon as you have the targeted store</span></span><br><span class="line"><span class="comment">// assignTo: mutates the action creator itself</span></span><br><span class="line"><span class="comment">// bindTo: returns a new action creator assigned to the store</span></span><br><span class="line"><span class="keyword">const</span> stringStore = createStore(stringReducer)</span><br><span class="line">replace.assignTo(stringStore)</span><br><span class="line">append = append.bindTo(stringStore)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Now, when calling actions, they will be automatically dispatched</span></span><br><span class="line">append(<span class="string">'r'</span>) <span class="comment">// stringStore.getState() === 'missing a letter'</span></span><br><span class="line">replace(<span class="string">'a'</span>) <span class="comment">// stringStore.getState() === 'a'</span></span><br><span class="line">append(<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>) <span class="comment">// stringStore.getState() === 'abcd'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// If you really need serializable actions, using string constant rather</span></span><br><span class="line"><span class="comment">// than runtime generated id, just use a uppercase description (with eventually some underscores)</span></span><br><span class="line"><span class="comment">// and it will be use as the id of the action</span></span><br><span class="line"><span class="keyword">const</span> doSomething = createAction(<span class="string">'STRING_CONSTANT'</span>)</span><br><span class="line">doSomething(<span class="number">1</span>) <span class="comment">// &#123; type: 'STRING_CONSTANT', payload: 1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Little bonus, if you need to support metadata around your action,</span></span><br><span class="line"><span class="comment">// like needed data but not really part of the payload, you add a second function</span></span><br><span class="line"><span class="keyword">const</span> metaAction = createAction(</span><br><span class="line">  <span class="string">'desc'</span>,</span><br><span class="line">  arg =&gt; arg,</span><br><span class="line">  arg =&gt; (&#123; <span class="attr">meta</span>: <span class="string">'so meta!'</span> &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Metadata will be the third argument of the reduce function</span></span><br><span class="line">createReducer(&#123;</span><br><span class="line">  [metaAction]: <span class="function">(<span class="params">state, payload, meta</span>) =&gt;</span> payload</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="API-说明"><a href="#API-说明" class="headerlink" title="API 说明"></a>API 说明</h2><h3 id="createAction-description-payloadReducer-metaReducer"><a href="#createAction-description-payloadReducer-metaReducer" class="headerlink" title="createAction([description], [payloadReducer], [metaReducer])"></a>createAction([description], [payloadReducer], [metaReducer])</h3><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ul>
<li>description（字符串，可选） 当显示的时候用于注册 action 名称和在开发者工具中使用。如果这个参数只是大写，它可以在不用生成任何 id 的情况下被用作<code>action</code>类型。你可以使用这个特性在服务端和客户端中有序整理<code>action</code>。</li>
<li>payloadReducer（方法，可选） 转变多个参数作为唯一的<code>payload</code>。</li>
<li>metaReducer（方法，可选） 转变多个参数作为唯一的元数据对象。</li>
</ul>
<h4 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h4><p>返回一个新的<code>action</code>构造器。如果你指定了<code>description</code>,它将被开发者工具使用。默认情况下，<code>createAction</code>返回一个方法，并且触发它的时候第一个参数被作为<code>payload</code>。如果你想支持多个参数，你需要指定一个<code>payloadReducer</code>来把所有的参数合并到<code>payload</code>中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Super simple action</span></span><br><span class="line"><span class="keyword">const</span> simpleAction = createAction()</span><br><span class="line"><span class="comment">// Better to add a description</span></span><br><span class="line"><span class="keyword">const</span> betterAction = createAction(<span class="string">'This is better!'</span>)</span><br><span class="line"><span class="comment">// Support multiple arguments by merging them</span></span><br><span class="line"><span class="keyword">const</span> multipleAction = createAction(<span class="function">(<span class="params">text, checked</span>) =&gt;</span> (&#123; text, checked &#125;))</span><br><span class="line"><span class="comment">// Again, better to add a description</span></span><br><span class="line"><span class="keyword">const</span> bestAction = createAction(<span class="string">'Best. Action. Ever.'</span>, (text, checked) =&gt; (&#123;</span><br><span class="line">  text,</span><br><span class="line">  checked</span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// Serializable action (the description will be used as the unique identifier)</span></span><br><span class="line"><span class="keyword">const</span> serializableAction = createAction(<span class="string">'SERIALIZABLE_ACTION'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="action-creator"><a href="#action-creator" class="headerlink" title="action creator"></a>action creator</h3><p><code>action</code>创造器基本上是一个携带参数并且返回<code>action</code>的方法，它具有以下格式：</p>
<ul>
<li>type：通过参数<code>description</code>生成 id</li>
<li>payload：当调用<code>action creator</code>时进行数据传递，传递的是第一个参数除非在创建<code>action</code>时指定了<code>payloadReducer</code>.</li>
<li>meta：如果你提供了<code>metaReducer</code>，它将创建一个<code>metadata</code>对象分配给这个<code>key</code>，否则它是<code>undefined</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> addTodo = createAction(<span class="string">'Add todo'</span>)</span><br><span class="line">addTodo(<span class="string">'content'</span>)</span><br><span class="line"><span class="comment">// return &#123; type: '[1] Add todo', payload: 'content' &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> editTodo = createAction(<span class="string">'Edit todo'</span>, (id, content) =&gt; (&#123; id, content &#125;))</span><br><span class="line">editTodo(<span class="number">42</span>, <span class="string">'the answer'</span>)</span><br><span class="line"><span class="comment">// return &#123; type: '[2] Edit todo', payload: &#123;id: 42, content: 'the answer'&#125; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serializeTodo = createAction(<span class="string">'SERIALIZE_TODO'</span>)</span><br><span class="line">serializeTodo(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// return &#123; type: 'SERIALIZE_TODO', payload: 1 &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>action creator</code>有以下方法：</p>
<h5 id="getType"><a href="#getType" class="headerlink" title="getType()"></a>getType()</h5><p>返回生成的类型并被用于这个<code>action creator</code>的所有<code>action</code>。</p>
<h5 id="assignTo-store-dispatch"><a href="#assignTo-store-dispatch" class="headerlink" title="assignTo(store | dispatch)"></a>assignTo(store | dispatch)</h5><p>记住你要触发这些<code>actions</code>，如果你有一个或多个<code>stores</code>，可以通过<code>assignTo</code>分配这些<code>action</code>。这会改变<code>action creator</code>本身，你可以传递一个<code>store</code>或者<code>dispatch</code>方法或者数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> action = createAction()</span><br><span class="line"><span class="keyword">let</span> action2 = createAction()</span><br><span class="line"><span class="keyword">const</span> reducer = createReducer(&#123;</span><br><span class="line">  [action]: <span class="function"><span class="params">state</span> =&gt;</span> state * <span class="number">2</span>,</span><br><span class="line">  [action2]: <span class="function"><span class="params">state</span> =&gt;</span> state / <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> store2 = createStore(reducer, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Automatically dispatch the action to the store when called</span></span><br><span class="line">action.assignTo(store)</span><br><span class="line">action() <span class="comment">// store.getState() === 2</span></span><br><span class="line">action() <span class="comment">// store.getState() === 4</span></span><br><span class="line">action() <span class="comment">// store.getState() === 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You can assign the action to several stores using an array</span></span><br><span class="line">action.assignTo([store, store2])</span><br><span class="line">action()</span><br><span class="line"><span class="comment">// store.getState() === 16</span></span><br><span class="line"><span class="comment">// store2.getState() === -2</span></span><br></pre></td></tr></table></figure>
<h5 id="bindTo-store-dispatch"><a href="#bindTo-store-dispatch" class="headerlink" title="bindTo(store | dispatch)"></a>bindTo(store | dispatch)</h5><p>如果你需要不可变，你可以使用该方法。它将生成一个新的<code>action creator</code>并且能够自动触发<code>action</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If you need more immutability, you can bind them, creating a new action creator</span></span><br><span class="line"><span class="keyword">const</span> boundAction = action2.bindTo(store)</span><br><span class="line">action2() <span class="comment">// Not doing anything since not assigned nor bound</span></span><br><span class="line"><span class="comment">// store.getState() === 16</span></span><br><span class="line"><span class="comment">// store2.getState() === -2</span></span><br><span class="line">boundAction() <span class="comment">// store.getState() === 8</span></span><br></pre></td></tr></table></figure>
<h5 id="assigned-bound-dispatched"><a href="#assigned-bound-dispatched" class="headerlink" title="assigned() / bound() / dispatched()"></a>assigned() / bound() / dispatched()</h5><p>测试<code>action creator</code>的当前状态。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> action = createAction()</span><br><span class="line">action.assigned() <span class="comment">// false, not assigned</span></span><br><span class="line">action.bound() <span class="comment">// false, not bound</span></span><br><span class="line">action.dispatched() <span class="comment">// false, test if either assigned or bound</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> boundAction = action.bindTo(store)</span><br><span class="line">boundAction.assigned() <span class="comment">// false</span></span><br><span class="line">boundAction.bound() <span class="comment">// true</span></span><br><span class="line">boundAction.dispatched() <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">action.assignTo(store)</span><br><span class="line">action.assigned() <span class="comment">// true</span></span><br><span class="line">action.bound() <span class="comment">// false</span></span><br><span class="line">action.dispatched() <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="raw-…args"><a href="#raw-…args" class="headerlink" title="raw(…args)"></a>raw(…args)</h5><p>当<code>action creator</code>无论是分配还是绑定，将不再返回<code>action</code>对象而是触发它。有些情况下，你需要没有触发的<code>action</code>。为了达到这个目的，你可以使用<code>raw</code>方法返回纯粹的<code>action</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> action = createAction().bindTo(store)</span><br><span class="line">action(<span class="number">1</span>) <span class="comment">// store has been updated</span></span><br><span class="line">action.raw(<span class="number">1</span>) <span class="comment">// return the action, store hasn't been updated</span></span><br></pre></td></tr></table></figure>
<h3 id="createReducer-handlers-defaultState"><a href="#createReducer-handlers-defaultState" class="headerlink" title="createReducer(handlers, [defaultState])"></a>createReducer(handlers, [defaultState])</h3><h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><ul>
<li>handlers（对象或方法）：如果是方法则携带两个属性，一是注册<code>action</code>，二是取消注册，如下。</li>
<li>defaultState（任意，可选）：<code>reducer</code>的初始状态，如果要在<code>combineReducers</code>使用千万不能为空。</li>
</ul>
<h4 id="用法-2"><a href="#用法-2" class="headerlink" title="用法"></a>用法</h4><p>返回一个新的<code>reducer</code>。和<code>Array.prototype.reduce</code>的语法类似，你可以指定如何累加，比如第一个参数并累加，或者默认的状态。默认的状态是可选的，因为创建时可以在<code>store</code>中获取，但你需要注意<code>reducer</code>中始终存在默认状态，尤其是你要结合<code>combineReducers</code>使用时。<br>有两种创建<code>reducer</code>的方式，一种是通过对象集合，所有方法必须遵循<code>previousState, payload) =&gt; newState</code>。另一种是使用工厂模式，话不多说，看下面的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> increment = createAction()</span><br><span class="line"><span class="keyword">const</span> add = createAction()</span><br><span class="line"></span><br><span class="line"><span class="comment">// First pattern</span></span><br><span class="line"><span class="keyword">const</span> reducerMap = createReducer(</span><br><span class="line">  &#123;</span><br><span class="line">    [increment]: <span class="function"><span class="params">state</span> =&gt;</span> state + <span class="number">1</span>,</span><br><span class="line">    [add]: <span class="function">(<span class="params">state, payload</span>) =&gt;</span> state + payload</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Second pattern</span></span><br><span class="line"><span class="keyword">const</span> reducerFactory = createReducer(<span class="function"><span class="keyword">function</span>(<span class="params">on, off</span>) </span>&#123;</span><br><span class="line">  on(increment, state =&gt; state + <span class="number">1</span>)</span><br><span class="line">  on(add, (state, payload) =&gt; state + payload)</span><br><span class="line">  <span class="comment">// 'off' remove support for a specific action</span></span><br><span class="line">  <span class="comment">// See 'Adding and removing actions' section</span></span><br><span class="line">&#125;, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h3 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h3><p><code>reducer</code>就是一个方法。它当前的状态和行为并返回新的状态，有以下方法：</p>
<h4 id="options-object"><a href="#options-object" class="headerlink" title="options(object)"></a>options(object)</h4><p>因为<code>action</code>是带有<code>type</code>、<code>payload</code>甚至还有<code>metadata</code>的对象。所有的<code>reduce</code>方法默认将<code>payload</code>作为它们的第二个参数，<code>metadata</code>作为第三个参数，而不是所有的<code>action</code>。因为所有其他属性由 lib 处理不用关心。如果你要使用全部的<code>action</code>，你可以改变<code>reducer</code>的行为。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = createAction()</span><br><span class="line"><span class="keyword">const</span> sub = createAction()</span><br><span class="line"><span class="keyword">const</span> reducer = createReducer(</span><br><span class="line">  &#123;</span><br><span class="line">    [add]: <span class="function">(<span class="params">state, action</span>) =&gt;</span> state + action.payload,</span><br><span class="line">    [sub]: <span class="function">(<span class="params">state, action</span>) =&gt;</span> state - action.payload</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">reducer.options(&#123;</span><br><span class="line">  payload: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="has-action-creator"><a href="#has-action-creator" class="headerlink" title="has(action creator)"></a>has(action creator)</h4><p>检测<code>reducer</code>是否含有<code>reduce</code>方法对于特定的<code>action</code>或者字符串类型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = createAction()</span><br><span class="line"><span class="keyword">const</span> sub = createAction()</span><br><span class="line"><span class="keyword">const</span> reducer = createReducer(</span><br><span class="line">  &#123;</span><br><span class="line">    [add]: <span class="function">(<span class="params">state, action</span>) =&gt;</span> state + action.payload</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">reducer.has(add) <span class="comment">// true</span></span><br><span class="line">reducer.has(sub) <span class="comment">// false</span></span><br><span class="line">reducer.has(add.getType()) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="on-action-creator-reduce-function-off-action-creator"><a href="#on-action-creator-reduce-function-off-action-creator" class="headerlink" title="on(action creator, reduce function) / off(action creator)"></a>on(action creator, reduce function) / off(action creator)</h4><p>可以动态添加或删除 action。</p>
<h3 id="assignAll-actionCreators-stores"><a href="#assignAll-actionCreators-stores" class="headerlink" title="assignAll(actionCreators, stores)"></a>assignAll(actionCreators, stores)</h3><h4 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h4><ul>
<li>actionCreators（对象或数组）</li>
<li>stores（对象或数组）</li>
</ul>
<h4 id="用法-3"><a href="#用法-3" class="headerlink" title="用法"></a>用法</h4><p>普遍的方式是导出一系列的 action 作为对象，如果你需要将所有绑定到 store，这里有一个超级小帮手。也可以使用 action 数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// actions.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = createAction(<span class="string">'Add'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sub = createAction(<span class="string">'Sub'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reducer.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createReducer(&#123;</span><br><span class="line">  [actions.add]: <span class="function">(<span class="params">state, payload</span>) =&gt;</span> state + payload,</span><br><span class="line">  [actions.sub]: <span class="function">(<span class="params">state, payload</span>) =&gt;</span> state - payload</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line">assignAll(actions, store);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<h3 id="bindAll-actionCreators-stores"><a href="#bindAll-actionCreators-stores" class="headerlink" title="bindAll(actionCreators, stores)"></a>bindAll(actionCreators, stores)</h3><h4 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h4><ul>
<li>actionCreators（对象或数组）</li>
<li>stores（对象或数组）</li>
</ul>
<h4 id="用法-4"><a href="#用法-4" class="headerlink" title="用法"></a>用法</h4><p>类似于<code>assignAll</code>,可以立刻绑定<code>action</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bindAll &#125; <span class="keyword">from</span> <span class="string">'redux-act'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> bindAll(actions, store);</span><br></pre></td></tr></table></figure>
<h3 id="disbatch-store-dispatch-actions"><a href="#disbatch-store-dispatch-actions" class="headerlink" title="disbatch(store | dispatch, [actions])"></a>disbatch(store | dispatch, [actions])</h3><h4 id="参数-4"><a href="#参数-4" class="headerlink" title="参数"></a>参数</h4><ul>
<li>store | dispatch （对象，store 或 diaptch 方法），在<code>store</code>上添加<code>disbatch</code>方法，类似于<code>diaptch</code>，但这个是触发多个<code>action</code>。</li>
<li>actions（数组，可选） 需要触发的一些<code>action</code></li>
</ul>
<h4 id="用法-5"><a href="#用法-5" class="headerlink" title="用法"></a>用法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// All samples will display both syntax with and without an array</span></span><br><span class="line"><span class="comment">// They are exactly the same</span></span><br><span class="line"><span class="keyword">import</span> &#123; disbatch &#125; <span class="keyword">from</span> <span class="string">'redux-act'</span></span><br><span class="line"><span class="keyword">import</span> &#123; inc, dec &#125; <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Add 'disbatch' directly to the store</span></span><br><span class="line">disbatch(store)</span><br><span class="line">store.disbatch(inc(), dec(), inc())</span><br><span class="line">store.disbatch([inc(), dec(), inc()])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Disbatch immediately from store</span></span><br><span class="line">disbatch(store, inc(), dec(), inc())</span><br><span class="line">disbatch(store, [inc(), dec(), inc()])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Disbatch immediately from dispatch</span></span><br><span class="line">disbatch(store.dispatch, inc(), dec(), inc())</span><br><span class="line">disbatch(store.dispatch, [inc(), dec(), inc()])</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

      

      
      

      <span class="post-tags">
        <a href="/blog/tags/react/">react</a><a href="/blog/tags/redux/">redux</a>
      </span>
      

    </div>

    
  </div>
</article>


<section id="comment" class="comment">
	<div id="gitment"></div>
</section>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
	var gitment = new Gitment({
		owner: 'lingmissing',
		repo: 'lingmissing-gitment',
		oauth: {
			client_id: 'c7675a51f3f7416ac3c0',
			client_secret: 'cac3475af0adfc9d1669114ef89e8c6ff59ac758',
		},
	})
	gitment.render('gitment')
</script>



      </main>

      <footer class="site-footer">
  <p class="site-info">
    
    &copy;
    2019
    elaine
    
  </p>
</footer>
      
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-75095706-1', 'auto');
    ga('send', 'pageview');
</script>

    </div>
  </div>
  <span class="back-top">⇡</span>
</body>

<script>
  window.onload = function () {
    var $backtop = document.querySelector('.back-top')
    var $body = document.body
    $body.addEventListener('scroll', function (e) {
      var currentscrolltop = e.target.scrollTop
      if (currentscrolltop > 500) {
        $backtop.style.display = 'block'
      } else {
        $backtop.style.display = 'none'
      }
    })
    $backtop.addEventListener('click', function () {
      $body.scrollTop = 0
    })
  }
</script>

</html>